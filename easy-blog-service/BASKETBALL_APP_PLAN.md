# 篮球约球应用开发规划文档

## 项目概述

开发一款寻找附近打篮球的人的应用，实现为微信小程序和微信公众号。通过地图定位、实时约球、场地管理等功能，帮助篮球爱好者快速找到球友和组织活动。

## 核心场景

### 场景一：实时约球

- 用户打开小程序可以看到周围 5 公里内正在召集球友的其他用户
- 召集中用户高亮显示，一小时内在线用户正常展示，超过一小时置灰
- 用户可以点击地图上的用户发起打篮球邀请或留言
- 发起召集后，在公众号中收到其他球友响应召集的消息推送

### 场景二：篮球场地管理

- 用户可以手动上传和标记篮球场地，包括名称、地理位置和照片
- 上传后与第三方地图服务（高德）核实，验证通过获得积分
- 场地信息对全体用户可见

### 场景三：约球帖子

- 用户可以手动发帖子约球，在地图上显示约球图标
- 约球信息包括：标题、地点、个人信息、联系方式、详细描述和配图
- 点击地图上的约球图标查看详情，可以报名参与
- 报名需要输入个人信息，并加入此群组

## 产品需求分析

### 核心功能模块

**1. 实时约球模块（场景一）**

- 用户位置定位与显示
- 5 公里范围内用户筛选
- 用户状态管理（召集中/在线/离线）
- 地图交互与用户标记
- 实时消息推送

**2. 篮球场地管理模块（场景二）**

- 场地信息录入（名称、位置、照片）
- 第三方地图服务集成验证
- 积分奖励系统
- 场地审核流程

**3. 约球帖子模块（场景三）**

- 帖子发布与管理
- 地图标记显示
- 报名参与功能
- 群组管理

### 用户角色与权限

- 普通用户：查看、参与约球
- 场地贡献者：上传场地信息
- 管理员：审核场地、管理用户

## 用户故事和使用场景

### 用户故事

**作为篮球爱好者，我希望：**

1. 能够快速找到附近想打篮球的人
2. 发起约球邀请并收到实时响应
3. 查看附近的篮球场地信息
4. 贡献新的篮球场地获得积分奖励
5. 通过帖子形式组织更正式的约球活动

### 详细使用场景

**场景一：实时约球**

- 用户 A 打开小程序，自动定位当前位置
- 显示 5 公里内其他用户，召集中用户高亮显示
- 用户 A 点击地图上的用户 B，发送约球邀请
- 用户 B 在公众号收到推送消息，可选择接受/拒绝
- 双方确认后建立临时聊天群组

**场景二：场地贡献**

- 用户发现新篮球场，拍照并标记位置
- 填写场地名称、开放时间等信息
- 系统调用高德地图 API 验证位置准确性
- 审核通过后用户获得积分奖励
- 场地信息对全体用户可见

**场景三：约球帖子**

- 用户发布约球帖子，包含时间、地点、人数等信息
- 帖子在地图上显示为特殊图标
- 其他用户点击查看详情并报名参与
- 组织者管理报名用户，建立微信群组

## 产品原型和界面流程

### 小程序主要页面结构

**1. 首页（地图页面）**

- 地图中心显示用户当前位置
- 不同颜色标记：召集中（红色高亮）、在线（绿色）、离线（灰色）
- 底部工具栏：约球、场地、我的
- 右上角：消息通知、设置

**2. 约球页面**

- 快速约球：选择时间、地点、人数
- 帖子约球：详细填写约球信息
- 我的约球：查看已发布和参与的约球

**3. 场地页面**

- 附近场地列表
- 场地详情：照片、位置、开放时间
- 添加新场地功能

**4. 个人中心**

- 用户信息、积分、等级
- 我的约球记录
- 我的场地贡献
- 设置和帮助

### 微信公众号功能

- 约球邀请推送
- 约球状态更新通知
- 场地审核结果通知
- 积分变动通知

## 数据库结构和数据模型

### 核心数据表设计

**1. 用户表 (users)**

```sql
- id: 主键
- openid: 微信openid
- unionid: 微信unionid
- nickname: 昵称
- avatar: 头像
- phone: 手机号
- location: 当前位置(经纬度)
- status: 在线状态(online/offline/gathering)
- last_active: 最后活跃时间
- points: 积分
- level: 等级
- created_at: 创建时间
- updated_at: 更新时间
```

**2. 约球表 (basketball_games)**

```sql
- id: 主键
- user_id: 发起人ID
- title: 标题
- description: 描述
- location: 地点(经纬度)
- address: 详细地址
- game_time: 约球时间
- max_players: 最大人数
- current_players: 当前人数
- status: 状态(active/completed/cancelled)
- images: 配图URLs
- contact_info: 联系方式
- created_at: 创建时间
```

**3. 场地表 (basketball_courts)**

```sql
- id: 主键
- name: 场地名称
- location: 位置(经纬度)
- address: 详细地址
- images: 照片URLs
- open_hours: 开放时间
- facilities: 设施信息
- status: 审核状态(pending/approved/rejected)
- contributor_id: 贡献者ID
- verified_at: 验证时间
- created_at: 创建时间
```

**4. 报名表 (game_participants)**

```sql
- id: 主键
- game_id: 约球ID
- user_id: 用户ID
- status: 状态(pending/confirmed/cancelled)
- contact_info: 联系方式
- joined_at: 加入时间
```

**5. 消息表 (messages)**

```sql
- id: 主键
- from_user_id: 发送者ID
- to_user_id: 接收者ID
- game_id: 关联约球ID
- type: 消息类型(invite/response/system)
- content: 消息内容
- status: 状态(unread/read)
- created_at: 创建时间
```

## 后端 API 接口设计

### 用户相关接口

```
POST /api/auth/login - 微信登录
GET /api/user/profile - 获取用户信息
PUT /api/user/profile - 更新用户信息
PUT /api/user/location - 更新用户位置
GET /api/user/nearby - 获取附近用户
```

### 约球相关接口

```
POST /api/games - 创建约球
GET /api/games - 获取约球列表
GET /api/games/:id - 获取约球详情
PUT /api/games/:id - 更新约球信息
DELETE /api/games/:id - 删除约球
POST /api/games/:id/join - 加入约球
DELETE /api/games/:id/leave - 退出约球
```

### 场地相关接口

```
POST /api/courts - 添加场地
GET /api/courts - 获取场地列表
GET /api/courts/:id - 获取场地详情
PUT /api/courts/:id - 更新场地信息
POST /api/courts/:id/verify - 验证场地
```

### 消息相关接口

```
POST /api/messages - 发送消息
GET /api/messages - 获取消息列表
PUT /api/messages/:id/read - 标记消息已读
```

### 微信相关接口

```
POST /api/wechat/notify - 微信消息推送
GET /api/wechat/callback - 微信回调处理
```

## 技术选型和架构设计

### 后端技术栈

- **框架**: NestJS (基于现有项目结构)
- **数据库**: PostgreSQL + Redis
- **ORM**: Prisma (与现有项目保持一致)
- **实时通信**: Socket.io
- **消息队列**: Bull Queue (Redis)
- **文件存储**: 阿里云 OSS/腾讯云 COS
- **地图服务**: 高德地图 API
- **微信服务**: 微信小程序 API + 微信公众号 API

### 前端技术栈

- **小程序**: 微信小程序原生开发
- **地图组件**: 腾讯地图/高德地图小程序 SDK
- **UI 组件**: Vant Weapp
- **状态管理**: MobX

### 微信公众号

- **开发语言**: JavaScript/TypeScript
- **模板消息**: 微信模板消息 API
- **菜单配置**: 微信自定义菜单

### 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   微信小程序     │    │   微信公众号     │    │   管理后台       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   NestJS API    │
                    │   (负载均衡)     │
                    └─────────────────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   PostgreSQL    │    │     Redis       │    │   文件存储       │
│   (主数据库)     │    │   (缓存/队列)    │    │   (OSS/COS)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## MVP 功能范围确定

### 第一阶段 MVP 功能（核心功能）

**小程序端：**

1. ✅ 用户微信登录和基础信息管理
2. ✅ 地图显示和用户位置定位
3. ✅ 附近用户显示（5 公里范围）
4. ✅ 用户状态管理（召集中/在线/离线）
5. ✅ 快速约球功能
6. ✅ 约球帖子发布和查看
7. ✅ 约球报名和参与
8. ✅ 基础消息功能

**后端服务：**

1. ✅ 用户管理和认证
2. ✅ 位置服务和地理计算
3. ✅ 约球管理
4. ✅ 实时消息推送
5. ✅ 微信 API 集成

**微信公众号：**

1. ✅ 约球邀请推送
2. ✅ 约球状态通知

### 第二阶段功能（增强功能）

- 场地管理模块
- 积分奖励系统
- 用户等级系统
- 群组聊天功能
- 数据统计和分析

### 第三阶段功能（高级功能）

- 智能推荐算法
- 社交功能扩展
- 商业化功能
- 多城市支持

## 开发计划和里程碑

### 开发时间线（总计 8-10 周）

**第 1-2 周：项目搭建和基础架构**

- [ ] 项目环境搭建
- [ ] 数据库设计和迁移
- [ ] 基础 API 框架搭建
- [ ] 微信小程序项目初始化
- [ ] 微信公众号配置

**第 3-4 周：用户系统和地图功能**

- [ ] 用户注册登录功能
- [ ] 微信授权和用户信息管理
- [ ] 地图集成和位置服务
- [ ] 附近用户查询功能
- [ ] 用户状态管理

**第 5-6 周：约球核心功能**

- [ ] 约球发布功能
- [ ] 约球列表和详情
- [ ] 约球报名参与
- [ ] 实时消息推送
- [ ] 微信公众号消息推送

**第 7-8 周：测试和优化**

- [ ] 功能测试和 bug 修复
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 安全测试
- [ ] 部署和上线准备

**第 9-10 周：上线和迭代**

- [ ] 小程序审核和发布
- [ ] 微信公众号发布
- [ ] 用户反馈收集
- [ ] 功能迭代优化

### 关键里程碑

1. **Week 2**: 基础架构完成，可以运行基础功能
2. **Week 4**: 用户系统和地图功能完成
3. **Week 6**: 核心约球功能完成
4. **Week 8**: MVP 版本完成，准备上线
5. **Week 10**: 正式上线，开始用户反馈收集

## 风险评估和应对策略

### 技术风险

- **地图服务稳定性**: 准备备用地图服务商
- **微信 API 限制**: 提前了解 API 调用限制，做好缓存策略
- **实时通信性能**: 使用 Redis 集群和负载均衡

### 业务风险

- **用户获取**: 制定用户增长策略，利用微信生态优势
- **内容审核**: 建立内容审核机制，防止垃圾信息
- **数据安全**: 加强用户隐私保护，符合相关法规

### 运营风险

- **服务器成本**: 合理规划服务器资源，使用云服务弹性扩展
- **维护成本**: 建立完善的监控和日志系统

## 后续规划

### 短期目标（3 个月内）

- 完成 MVP 版本开发和上线
- 获得 1000+活跃用户
- 收集用户反馈，优化产品体验

### 中期目标（6 个月内）

- 增加场地管理功能
- 实现积分奖励系统
- 扩展到 2-3 个城市

### 长期目标（1 年内）

- 实现商业化功能
- 建立完整的篮球社区生态
- 考虑扩展到其他运动项目

---

_文档创建时间: 2024 年_
_版本: v1.0_
_状态: 规划阶段_
